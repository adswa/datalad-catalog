<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />

    <title>DataLad Catalog</title>

    <!-- Required Stylesheets -->
    <link rel="stylesheet" type="text/css" href="assets/style.css" />
    <script src="https://kit.fontawesome.com/17e62561a1.js" crossorigin="anonymous"></script>
    <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css"/>
    <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css"/>

    <!-- Load polyfills to support older browsers -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es2015%2CIntersectionObserver"></script>

    <!-- Required scripts -->
    <script src="https://unpkg.com/vue@latest/dist/vue.js"></script>
    <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>
    <script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
    <script src="assets/md5-2.3.0.js"></script>

    <!-- Template for recursive tree item -->
    <script type="text/x-template" id="item-template">
      <li>
        <div :class="{bold: isFolder}" @click="toggle">
          <span v-if="isFolder && isOpen"> <i class="far fa-folder-open"></i> {{ displayText }}</span>
          <span v-else-if="isFolder && !isOpen"> <i class="far fa-folder"></i> {{ displayText }}</span>
          <span v-else-if="isDataset"> <i class="fas fa-folder-plus"></i> <a class="subdataset" @click="selectDataset(item, item.id)">{{ displayText }}</a></span>
          <span v-else> <i class="far fa-file-alt"></i> {{ displayText }}</span>
        </div>
        <ul v-show="isOpen" v-if="isFolder">
          <tree-item class="item" v-for="(child, index) in item.children" :key="index" :index="index" :item="child"></tree-item>
        </ul>
      </li>
    </script>

    <!-- Template for main page -->
    <script type="text/x-template" id="main-template">
      <div>
        <br>
        <h2 class="text-center">Browse datasets</h2>
        <b-card border-variant="dark" v-for="sds in superdatasets" class="mb-2 p-0">
          <b-card-body>
            <b-row no-gutters align-v="center">
              <b-col md="9">
                <b-card-title><a @click="selectDataset(sds, sds.dataset_id)" class="stretched-link">{{sds.name}}</a></b-card-title>
                <b-card-sub-title class="mb-2">
                  <span v-for="(author, index) in sds.authors">{{author.givenName}} {{author.familyName}}<span v-if="index != sds.authors.length - 1">, </span></span>
                </b-card-sub-title>
                <b-card-text>
                  <strong>Version:</strong> {{sds.dataset_version.substring(0,7)}}&nbsp;
                  <strong>Metadata extracted:</strong> {{sds.last_edited}}&nbsp;
                  <strong>DOI:</strong> <a :href="sds.doi" target="_blank">{{sds.doi.replace("https://doi.org/", "")}}</a>&nbsp;
                  <strong>License:</strong> <a :href="sds.license.url" target="_blank">{{sds.license.name}}</a>&nbsp;
                </b-card-text>
              </b-col>
              <b-col md="3">
                <b-card-text>
                  <b-button pill disabled size="sm" variant="outline-dark" v-for="keyword in sds.keywords">{{keyword}}</b-button>
                </b-card-text>
              </b-col>
            </b-row>
          </b-card-body>
        </b-card>
      </div>
    </script>


    <!-- Template for dataset page -->
    <script type="text/x-template" id="dataset-template">
      <div>
        <b-card border-variant="dark">
          <b-card-body>
            <b-card-title><a @click="gotoHome" class="newlink"><i class="fas fa-home"></i></a> / {{selectedDataset.name}}</b-card-title> <!-- &mldr; -->
            <b-card-sub-title class="mb-2">
              <span v-for="(author, index) in selectedDataset.authors">{{author.givenName}} {{author.familyName}}<span v-if="index != selectedDataset.authors.length - 1">, </span></span>
            </b-card-sub-title>
            <b-card-text>
              <strong>Version:</strong> {{selectedDataset.dataset_version.substring(0,7)}}&nbsp;
              <strong>Metadata extracted:</strong> {{displayData.metadata_extracted}}&nbsp;
              <strong>DOI:</strong> <a v-show="selectedDataset.doi" :href="selectedDataset.doi" target="_blank">{{selectedDataset.doi.replace("https://doi.org/", "")}}</a><span v-show="displayData.doi"><em>{{displayData.doi}}</em></span>&nbsp;
              <strong>License:</strong> <a v-show="selectedDataset.license.name" :href="selectedDataset.license.url" target="_blank">{{selectedDataset.license.name}}</a><span v-show="displayData.license"><em>{{displayData.license}}</em></span>&nbsp;
            </b-card-text>
            <hr>
            <b-row no-gutters>
              <b-col md="9" style="text-align: justify;">
                <b-card-text>
                  <strong>Description:</strong><br>
                  <span>{{selectedDataset.description}}</span>
                </b-card-text>
              </b-col>
              <!-- <b-col md="1"></b-col> -->
              <b-col md="3">
                <b-card-text>
                  <strong>Keywords:</strong> <br>
                  <b-button pill disabled size="sm" variant="outline-dark" v-for="keyword in selectedDataset.keywords">{{keyword}}</b-button>
                </b-card-text>
              </b-col>
            </b-row>
            <br>
            <div style="text-align: left;">
                <b-button variant="outline-dark" size="sm" v-b-modal.modal-1><i class="fas fa-cloud-download-alt"></i> Download with DataLad</b-button>&nbsp;
                <b-button variant="outline-dark" size="sm" href="#"><i class="fab fa-github"></i> View on GitHub</b-button>&nbsp;
                <b-button variant="outline-dark" size="sm"><i class="fas fa-quote-right"></i> Cite</b-button>&nbsp;
                <b-button variant="outline-dark" size="sm" href="web/64f46a4c10ecd4951934f1ae93487fa7.json" download="ds_64f46a4c10ecd4951934f1ae93487fa7.json"><i class="fas fa-share"></i> Export metadata</b-button>&nbsp;
                <b-modal id="modal-1" size="lg" 
                header-bg-variant="light"
                footer-bg-variant="light"
                body-bg-variant="light"
                body-text-variant="dark"
                ok-only>
                  <template #modal-header="{ close }">
                    <div class="d-block text-center">
                      <h3>Download with <img src="artwork/datalad_logo_wide.svg" width="100em"></h3>
                    </div>
                  </template>
                  <h5>Step 1: Install DataLad</h5>
                  <p class="my-4">Make sure that you have a recent version of DataLad installed on your system.
                    Full instructions are provided in the
                    <a href="http://handbook.datalad.org/en/latest/intro/installation.html#install">DataLad Handbook.</a>
                  </p>
                  <h5>Step 2: Clone the dataset</h5>
                  <p class="my-4">The dataset can be cloned by running:</p>
                  <div class="shadow-sm p-3 mb-3 bg-white rounded">
                    <b-row>
                      <b-col cols="11">
                        <code id="clone_code">
                          datalad clone {{selectedDataset.url}}
                        </code>
                      </b-col>
                      <b-col cols="1">
                        <i id="copyBtn" class="far fa-clone" @click="copyCloneCommand"></i>
                        <b-tooltip target="copyBtn" :show.sync="showCopyTooltip" @shown="hideTooltipLater" triggers left title="Copied!">
                        </b-tooltip>
                      </b-col>
                    </b-row>
                  </div>
                  <p class="my-4">Once the dataset is cloned, it is a light-weight directory on your local machine.
                    At this point, it contains only small metadata and information on the identity of the files in the dataset,
                    but not actual content of the (sometimes large) data files.
                  </p>
                  <h5>Step 3: Retrieve dataset content</h5>
                  <p class="my-4">After cloning the dataset, you can retrieve file contents by running:</p>
                  <div class="shadow-sm p-3 mb-3 bg-white rounded">
                    <code>
                      datalad get path/to/directory/or/file
                    </code>
                  </div>
                  <p class="my-4">This command will trigger a download of the files, directories, or subdatasets you have specified.</p>
                  
                </b-modal>
            </div>
          </b-card-body>
          <b-card-body>
            <b-tabs card content-class="mt-3" fill active-nav-item-class="font-weight-bold">
              <b-tab>
                <template v-slot:title>
                  <i class="fas fa-list-ol"></i> Subdatasets
                </template>
                <span v-if="!selectedDataset.subdatasets || !selectedDataset.subdatasets.length"><em>There are no subdatasets listed for the current dataset</em></span>
                <span v-else v-for="ds in selectedDataset.subdatasets">
                  <b-card border-variant="dark" header-bg-variant="transparent" no-body class="mb-2">
                    <template v-slot:header>
                      <b-row no-gutters>
                        <b-col align-h="center" align-v="center" md="1">
                          <span class="xxlfont"><i class="fas fa-database"></i></span>
                        </b-col>
                        <b-col class="text-muted" md="9">
                          <h5><a @click="selectDataset(ds, ds.dataset_id)" class="stretched-link">{{ds.dataset_path}}</a></h5>
                          <small>{{ds.dataset_id}}</small>
                        </b-col>
                        <b-col md="2">
                          <small>
                            <strong>Version:</strong> {{ds.dataset_version.substring(0,7)}} <br>
                            <strong>Size:</strong> xxx <br>
                            <strong>Files:</strong> yyy <br>
                          </small>
                        </b-col>
                      </b-row>
                    </template>
                  </b-card>
                </span>
              </b-tab>
              <b-tab>
                <template v-slot:title>
                  <i class="far fa-folder"></i> Files
                </template>
                <b-card no-body class="p-2">
                  <!-- <p><a href=""><i class="fas fa-home"></i></a> /
                    <span v-for="path in dataPath"><a href="">{{path}}</a> /</span>
                  </p> -->
                  <ul>
                    <tree-item class="item" v-for="item in selectedDataset.children" :item="item"></tree-item>
                  </ul>
                </b-card>
              </b-tab>
              <b-tab>
                <template v-slot:title>
                  <i class="fas fa-book"></i> Publications
                </template>
                <span v-if="!selectedDataset.publications || !selectedDataset.publications.length"><em>There are no publications listed for the current dataset</em></span>
                <span v-else v-for="pub in selectedDataset.publications">
                  <b-card border-variant="dark" header-bg-variant="transparent" no-body class="mb-2">
                    <template v-slot:header>
                      <b-row no-gutters>
                        <b-col align-h="center" align-v="center" md="1">
                          <span class="xxlfont"><i class="fas fa-book "></i></span>
                        </b-col>
                        <b-col class="text-muted" md="8">
                          <h5>{{pub.headline}}</h5>
                          <small><span v-for="(author, index) in pub.author">{{author.givenName}} {{author.familyName}}<span v-if="index != pub.author.length - 1">, </span></span></small><br>
                        </b-col>
                        <b-col md="3">
                          <small>
                            Published: {{pub.datePublished}} <br>
                            DOI: <a :href="pub.doi" target="_blank">{{pub.doi.replace("https://doi.org/", "")}}</a> <br>
                            Journal: {{pub.publication.name}}
                          </small>
                        </b-col>
                      </b-row>
                    </template>
                  </b-card>
                </span>
              </b-tab>
              <b-tab>
                <template v-slot:title>
                  <i class="fas fa-dollar-sign"></i> Funding
                </template>
                <span v-if="!selectedDataset.funding || !selectedDataset.funding.length"><em>There are no funding sources listed for the current dataset</em></span>
                <span v-else>
                  <div class="accordion" role="tablist">
                    <b-card no-body class="mb-1" v-for="fund in selectedDataset.funding" v-bind:key="fund.name">
                      <b-card-header header-tag="header" class="p-1" role="tab">
                        <b-button block  v-b-toggle="fund.name" variant="light" class="stretched-link">{{fund.name.split(',')[0]}}</b-button>
                      </b-card-header>
                      <b-collapse :id="fund.name" accordion="my-accordion" role="tabpanel">
                        <b-card-body>
                          <b-card-text>
                            <strong>Type</strong>: {{fund["@type"]}}<br>
                            <strong>Identifier</strong>: {{fund.name.split(',')[1]}}<br>
                          </b-card-text>
                        </b-card-body>
                      </b-collapse>
                    </b-card>
                  </div>
                </span>
              </b-tab>
            </b-tabs>
          </b-card-body>
        </b-card>
      </div>
    </script>


  </head>

  <!-- ### -->
  <!-- ### -->
  <!-- ### -->
  <!-- ### -->
  <!-- ### -->
  <!-- ### -->
  <!-- ### -->
  <body>
    <!-- Our application root element -->
    <b-container id="demo" >
      <b-container style="margin-top:20px;">
        <b-row align-v="end">
          <b-col cols="9">
            <a @click="gotoHome"><img src="artwork/View1.svg" class="d-inline-block" alt="datalad" style="width:100%;"></a>
          </b-col>
          <b-col cols="1"></b-col>
          <b-col cols="2" align-h="end"> <!-- style="text-align: right; vertical-align: bottom;" -->
            <!-- <b-avatar-group overlap="0.05" size="3rem">
              <b-avatar href="#" src="artwork/readthedocs_logo.png"></b-avatar>
              <b-avatar href="http://handbook.datalad.org/en/latest/" src="artwork/handbook_logo.svg"></b-avatar>
              <b-avatar href="https://github.com/jsheunis/data-browser-from-metadata"><i class="fab fa-github"></i></b-avatar>
              <b-avatar href="https://twitter.com/datalad"><i class="fab fa-twitter"></i></b-avatar>
            </b-avatar-group> -->
            <b-navbar toggleable="lg" type="light" variant="outline-dark">
          
              <b-navbar-toggle target="navbar-toggle-collapse">
                <!-- <template #default="{ expanded }">
                  <b-icon v-if="expanded" icon="chevron-bar-up"></b-icon>
                  <b-icon v-else icon="chevron-bar-down"></b-icon>
                </template> -->
              </b-navbar-toggle>
          
              <b-collapse id="navbar-toggle-collapse" is-nav>
                <b-navbar-nav class="ml-auto mb-0 xlfont">
                  <b-nav-item v-b-tooltip.hover title="Read documentation" href="#"><i class="fas fa-file-alt"></i></b-nav-item>
                  <b-nav-item v-b-tooltip.hover title="View code base" href="#"><i class="fab fa-github"></i></b-nav-item>
                  <b-nav-item v-b-tooltip.hover title="Follow DataLad!" href="#"><i class="fab fa-twitter"></i></b-nav-item>
                </b-navbar-nav>
              </b-collapse>
            </b-navbar>
            <!-- <b-avatar-group overlap="0.05" size="3rem">
              <b-avatar href="#" src="artwork/readthedocs_logo.png"></b-avatar>
              <b-avatar href="http://handbook.datalad.org/en/latest/" src="artwork/handbook_logo.svg"></b-avatar>
              <b-avatar href="https://github.com/jsheunis/data-browser-from-metadata"><i class="fab fa-github"></i></b-avatar>
              <b-avatar href="https://twitter.com/datalad"><i class="fab fa-twitter"></i></b-avatar>
            </b-avatar-group> -->
            <!-- <h3><i class="fab fa-twitter"></i>&nbsp;&nbsp;<i class="fab fa-github"></i></h3> -->
          </b-col>
        </b-row>
      </b-container>
      <br>
      <div>
        <!-- route outlet -->
        <!-- component matched by the route will render here -->
        <router-view :selected-dataset="selectedDataset"></router-view>
      </div> 
    </b-container>

    <b-container>
      <br>
      <br>
      <br>
      <br>
    </b-container>

    <!-- Start running your app -->
    <script src="assets/vue_app.js"></script>
    
  </body>
</html>